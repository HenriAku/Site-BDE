{% extends '_template/base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="../asset/css/panier.css">

{% endblock %}

{% block body %}
<div class="panier-container">
    <h1>Panier de {{ user.lastname }}</h1>
    
    {% set total_general = 0 %}
    {% set paniers_user = paniers|filter(p => p.getn_user() == user.id) %}
    
    {% if paniers_user|length > 0 %}
        <div class="produits-list">
            {% for panier in paniers_user %}
                {% set produit = produits|filter(p => p.getn_produit() == panier.getn_produit())|first %}
                {% if produit %}
                    <div class="produit-accordion">
                        <div class="produit-header" onclick="toggleDetails(this)">
                            <div>
                                <strong>{{ produit.getName() }}</strong> - {{ produit.getPrice() }} €
                                <span class="badge">×{{ panier.getqte() }}</span>
                            </div>
                            <div class="arrow">▼</div>
                        </div>
                        
                        <div class="produit-details">
                            <table>
                                <tr>
                                    <th>Référence</th>
                                    <td>DP-{{ panier.getn_produit() }}</td>
                                </tr>
                                <tr>
                                    <th>Taille</th>
                                    <td>{{ produit.getSize() }}</td>
                                </tr>
                                <tr>
                                    <th>Couleur</th>
                                    <td>
                                        <div style="display: inline-block; width: 20px; height: 20px; background: {{ produit.getColor() }}; border: 1px solid #000;"></div>
                                        {{ produit.getColor() }}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Quantité</th>
                                    <td>{{ panier.getqte() }}</td>
                                </tr>
                                <tr>
                                    <th>Total</th>
                                    <td>{{ produit.getPrice() * panier.getqte() }} €</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    {% set total_general = total_general + (produit.getPrice() * panier.getqte()) %}
                {% endif %}
            {% endfor %}
            
            <div class="total-section">
                <strong>Total général : {{ total_general }} €</strong>
            </div>
        </div>
    {% else %}
        <p class="empty-cart">Votre panier est vide</p>
    {% endif %}
</div>

<script>
    function toggleDetails(header) {
        const accordion = header.parentElement;
        const details = accordion.querySelector('.produit-details');
        const arrow = header.querySelector('.arrow');
        
        if (details.style.maxHeight) {
            details.style.maxHeight = null;
            arrow.classList.remove('down');
        } else {
            details.style.maxHeight = details.scrollHeight + 'px';
            arrow.classList.add('down');
        }
    }
    
    // Optionnel: Ouvrir le premier élément par défaut
    document.addEventListener('DOMContentLoaded', function() {
        const firstHeader = document.querySelector('.produit-header');
        if (firstHeader) toggleDetails(firstHeader);
    });
</script>
{% endblock %}
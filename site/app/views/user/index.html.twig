{% extends '_template/base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="../asset/css/users.css">
{% endblock %}

{% block body %}
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th scope="col">#ID</th>
        <th scope="col">Pr√©nom</th>
        <th scope="col">Nom</th>
        <th scope="col">Email</th>
        <th scope="col">Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for user in users %}
        <tr id="user-row-{{ user.id }}">
            <td>{{ user.id }}</td>
            <td>{{ user.firstname }}</td>
            <td>{{ user.lastname }}</td>
            <td>{{ user.email }}</td>
            <td>
                <button class="favorite styled delete-user" type="button" data-user-id="{{ user.id }}">Supprimer</button>
            </td>
            <td>
                <a href="user_update.php?id={{ user.id }}" class="btn btn-warning btn-sm"><i class="fa fa-edit"></i></a>
                <a href="user_delete.php?id={{ user.id }}" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<div class="d-flex flex-row-reverse">
    <a href="user_create.php" class="btn btn-success">
        <i class="fa fa-plus"></i> Ajouter un utilisateur
    </a>
</div>

<script>
document.querySelectorAll('.delete-user').forEach(button => {
    button.addEventListener('click', function() {
        const userId = this.getAttribute('data-user-id');
        if (confirm('Voulez-vous vraiment supprimer cet utilisateur ?')) {
            fetch('/users.php?action=delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'id=' + encodeURIComponent(userId)
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw err; });
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    document.getElementById('user-row-' + userId).remove();
                } else {
                    alert('Erreur lors de la suppression : ' + (data.error || 'Erreur inconnue'));
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Erreur lors de la suppression : ' + (error.error || error.message || 'Erreur inconnue'));
            });
        }
    });
});
</script>
{% endblock %}